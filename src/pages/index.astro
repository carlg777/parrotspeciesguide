---
import BaseLayout from "../layouts/BaseLayout.astro";
import { Image, getImage } from 'astro:assets';
import parrotFunFacts from '../assets/img/parrot-fun-facts-infographic.jpg';
import parrotFunFactsMobile from '../assets/img/parrot-fun-facts-mobile.jpg';
import CategoryCard from '../components/home/CategoryCard.astro';
import { getCollection } from 'astro:content';

// Get all species
const allSpecies = await getCollection('species');

// Get unique categories
const categories = [...new Set(allSpecies.map(s => s.data.category))].sort();

const faqStructuredData = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "How do I choose the right parrot species?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Compare size, noise level, temperament, and care needs. Start with species that match your space, time, and experience level."
      }
    },
    {
      "@type": "Question",
      "name": "Are parrots noisy?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Noise varies by species. Smaller parrots are often quieter, while macaws and cockatoos are typically loud."
      }
    },
    {
      "@type": "Question",
      "name": "What do parrots eat?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Most species thrive on pellets plus fresh vegetables, fruit, and limited seeds. Each species profile includes diet guidance."
      }
    },
    {
      "@type": "Question",
      "name": "How long do parrots live?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Lifespan depends on the species. Many parrots live 15 to 60+ years with proper care."
      }
    }
  ]
};

const faqDataString = JSON.stringify(faqStructuredData).replace(/</g, '\\u003c');
---

<BaseLayout
  title="Parrot Species Guide | Complete Care Information"
  description="Explore detailed profiles of 84+ parrot species. Learn about temperament, care requirements, noise levels, and more for Macaws, Cockatoos, Amazons, African Greys, and other pet parrots."
  canonical="https://www.parrotspeciesguide.com/"
  ogTitle="Complete Parrot Species Guide"
  ogDescription="Discover the perfect parrot species for your home. Detailed care information, temperament profiles, and expert guidance."
  dataPage="home"
>
  <Fragment slot="head">
    <script type="application/ld+json" is:inline>
      {faqDataString}
    </script>
  </Fragment>
  <main class="container page-main">
    <header class="page-header">
      <h1 class="page-title page-title--xl">
        ðŸ¦œ Parrot Species Guide
      </h1>
      <p class="page-subtitle--wide">
        Comprehensive care information for {allSpecies.length} parrot species
      </p>
      <div class="cta-spacer">
        <a href="/species" class="button button-hero">
          Explore All Species â†’
        </a>
      </div>
    </header>

    <section class="section">
      <h2 class="section-title section-title--xl">Browse by Category</h2>
      <div class="category-grid">
        {categories.map(category => {
          const categorySpecies = allSpecies.filter(s => s.data.category === category);
          const count = categorySpecies.length;
          
          // Image Selection Strategy:
          // 1. check for manual override (e.g. for better visuals or fixing corrupted images)
          // 2. Default to the first species in the category
          const overrides: { [key: string]: string } = {
            "African Parrots": "congo-african-grey"
          };
          
          let featuredSpecies = categorySpecies[0];
          if (overrides[category]) {
            const overrideMatch = categorySpecies.find(s => s.data.slug === overrides[category]);
            if (overrideMatch) featuredSpecies = overrideMatch;
          }

          const imagePath = featuredSpecies ? featuredSpecies.data.image : '/assets/img/parrots/placeholder.webp'; // Fallback

          return (
            <CategoryCard 
              category={category}
              count={count}
              imagePath={imagePath}
              href={`/species#${category.toLowerCase().replace(/\s+/g, '-')}`}
            />
          );
        })}
      </div>
    </section>

    <section class="section">
      <h2 class="section-title section-title--xl">Did You Know?</h2>
      <div class="infographic-container">
        <picture>
          {/* Mobile Image (Optimized) */}
          <source
            media="(max-width: 767px)"
            srcset={(await getImage({src: parrotFunFactsMobile, format: 'webp', width: 800})).src}
          />
          {/* Desktop Image (Optimized) */}
          <source
            media="(min-width: 768px)"
            srcset={(await getImage({src: parrotFunFacts, format: 'webp', width: 1200})).src}
          />
          {/* Fallback & Default */}
          <img
            src={(await getImage({src: parrotFunFacts, format: 'webp', width: 1200})).src}
            alt="Parrot Power Infographic: Fun facts about intelligence, tool use, climbing, feet, mating, and habitats of parrots"
            class="infographic-image"
            style="width: 100%; height: auto;"
            loading="lazy"
            decoding="async"
          />
        </picture>
      </div>
    </section>

    <section class="cta-panel">
      <h2 class="section-title section-title--xl">Find Your Perfect Parrot</h2>
      <p class="cta-panel__text">
        Learn about each species' temperament, care needs, noise levels, and housing requirements
      </p>
      <a href="/species" class="button button-hero-secondary">
        View All Species
      </a>
    </section>

    <section class="section">
      <h2 class="section-title section-title--xl">Parrot Species FAQ</h2>
      <div class="faq-grid faq-container">
        <div class="filters-panel__card">
          <h3 class="faq-question">How do I choose the right parrot species?</h3>
          <p class="faq-answer">
            Compare size, noise level, temperament, and care needs. Start with species that match your space, time, and experience level.
          </p>
        </div>
        <div class="filters-panel__card">
          <h3 class="faq-question">Are parrots noisy?</h3>
          <p class="faq-answer">
            Noise varies by species. Smaller parrots are often quieter, while macaws and cockatoos are typically loud.
          </p>
        </div>
        <div class="filters-panel__card">
          <h3 class="faq-question">What do parrots eat?</h3>
          <p class="faq-answer">
            Most species thrive on pellets plus fresh vegetables, fruit, and limited seeds. Each species profile includes diet guidance.
          </p>
        </div>
        <div class="filters-panel__card">
          <h3 class="faq-question">How long do parrots live?</h3>
          <p class="faq-answer">
            Lifespan depends on the species. Many parrots live 15 to 60+ years with proper care.
          </p>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>
