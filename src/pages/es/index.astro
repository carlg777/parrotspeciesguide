---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { Image, getImage } from 'astro:assets';
import parrotFunFacts from '../../assets/img/parrot-fun-facts-infographic.jpg';
import parrotFunFactsMobile from '../../assets/img/parrot-fun-facts-mobile.jpg';
import CategoryCard from '../../components/home/CategoryCard.astro';
import { getCollection } from "astro:content";

const categoryTranslations: Record<string, string> = {
  "African Parrots": "Loros Africanos",
  "Amazons": "Amazonas",
  "Caiques": "Caiques",
  "Cockatoos": "CacatÃºas",
  "Conures": "Cotorras",
  "Eclectus": "Eclectus",
  "Kakarikis": "Kakarikis",
  "Lories & Lorikeets": "Loris y Loriquitos",
  "Lovebirds": "Agapornis",
  "Macaws": "Guacamayos",
  "Parakeets": "Periquitos",
  "Parrotlets": "Loritos",
  "Pionus": "Pionus"
};

const allSpecies = await getCollection("species");
const categories = [...new Set(allSpecies.map((s) => s.data.category))].sort();

const faqStructuredData = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "Â¿CÃ³mo elijo la especie de loro adecuada?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Compara el tamaÃ±o, el nivel de ruido, el temperamento y los cuidados. Elige una especie que encaje con tu espacio y experiencia."
      }
    },
    {
      "@type": "Question",
      "name": "Â¿Los loros son ruidosos?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Depende de la especie. Las aves pequeÃ±as suelen ser mÃ¡s silenciosas, mientras que los guacamayos y las cacatÃºas suelen ser ruidosos."
      }
    },
    {
      "@type": "Question",
      "name": "Â¿QuÃ© comen los loros?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "La mayorÃ­a prospera con pellets, verduras frescas, fruta y pocas semillas. Cada perfil incluye recomendaciones de dieta."
      }
    },
    {
      "@type": "Question",
      "name": "Â¿CuÃ¡nto vive un loro?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "La esperanza de vida depende de la especie. Muchos loros viven de 15 a mÃ¡s de 60 aÃ±os con buenos cuidados."
      }
    }
  ]
};

const faqDataString = JSON.stringify(faqStructuredData).replace(/</g, '\\u003c');
---

<BaseLayout
  title="GuÃ­a de Especies de Loros | Cuidados y Perfiles"
  description="GuÃ­as completas de cuidado para mÃ¡s de 84 especies de loros. Descubre temperamento, dieta, nivel de ruido, tamaÃ±o, origen y alojamiento."
  canonical="https://www.parrotspeciesguide.com/es/"
  ogTitle="GuÃ­a de Especies de Loros | Cuidados"
  ogDescription="Encuentra la especie ideal con perfiles de temperamento, dieta, ruido y alojamiento."
  dataPage="home"
>
  <Fragment slot="head">
    <script type="application/ld+json" is:inline>
      {faqDataString}
    </script>
  </Fragment>
  <main class="container page-main">
    <header class="page-header">
      <h1 class="page-title page-title--xl">
        ðŸ¦œ GuÃ­a de Especies de Loros
      </h1>
      <p class="page-subtitle--wide">
        Perfiles completos de cuidado para {allSpecies.length} especies de loros domÃ©sticos.
      </p>
      <p class="page-subtitle--support">
        Compara tamaÃ±o, origen, nivel de ruido y necesidades de vivienda para elegir la especie ideal para tu hogar.
      </p>
      <div class="cta-spacer">
        <a href="/es/species" class="button button-hero">
          Explorar Todas las Especies â†’
        </a>
      </div>
    </header>

    <section class="section">
      <h2 class="section-title section-title--xl">CategorÃ­as de Especies de Loros</h2>
      <div class="category-grid">
        {categories.map(category => {
          const categorySpecies = allSpecies.filter(s => s.data.category === category);
          const count = categorySpecies.length;

          // Image Selection Strategy:
          // 1. check for manual override (e.g. for better visuals or fixing corrupted images)
          // 2. Default to the first species in the category
          const overrides: { [key: string]: string } = {
            "African Parrots": "congo-african-grey"
          };
          
          let featuredSpecies = categorySpecies[0];
          if (overrides[category]) {
            const overrideMatch = categorySpecies.find(s => s.data.slug === overrides[category]);
            if (overrideMatch) featuredSpecies = overrideMatch;
          }

          const imagePath = featuredSpecies ? featuredSpecies.data.image : '/assets/img/parrots/placeholder.webp'; // Fallback
          const translatedCategory = categoryTranslations[category] || category;

          return (
            <CategoryCard 
              category={translatedCategory}
              count={count}
              imagePath={imagePath}
              href={`/es/species#${category.toLowerCase().replace(/\s+/g, '-')}`}
            />
          );
        })}
      </div>
    </section>

    <section class="section">
      <h2 class="section-title section-title--xl">Â¿SabÃ­as Que?</h2>
      <div class="infographic-container">
        <picture>
          {/* Mobile Image (Optimized) */}
          <source
            media="(max-width: 767px)"
            srcset={(await getImage({src: parrotFunFactsMobile, format: 'webp', width: 800})).src}
          />
          {/* Desktop Image (Optimized) */}
          <source
            media="(min-width: 768px)"
            srcset={(await getImage({src: parrotFunFacts, format: 'webp', width: 1200})).src}
          />
          {/* Fallback & Default */}
          <img
            src={(await getImage({src: parrotFunFacts, format: 'webp', width: 1200})).src}
            alt="InfografÃ­a de Poder de los Loros: Datos curiosos sobre inteligencia, uso de herramientas, escalada, patas, apareamiento y hÃ¡bitats de los loros"
            class="infographic-image"
            style="width: 100%; height: auto;"
            loading="lazy"
            decoding="async"
          />
        </picture>
      </div>
    </section>

    <section class="cta-panel">
      <h2 class="section-title section-title--xl">Encuentra tu Especie de Loro Ideal</h2>
      <p class="cta-panel__text">
        Conoce el temperamento, los cuidados, la alimentaciÃ³n, los niveles de ruido y las necesidades de alojamiento de cada especie.
      </p>
      <a href="/es/species" class="button button-hero-secondary">
        Ver Todas las Especies
      </a>
    </section>

    <section class="section">
      <h2 class="section-title section-title--xl">Preguntas Frecuentes sobre Especies de Loros</h2>
      <div class="faq-grid faq-container">
        <div class="filters-panel__card">
          <h3 class="faq-question">Â¿CÃ³mo elijo la especie de loro adecuada?</h3>
          <p class="faq-answer">
            Compara el tamaÃ±o, el nivel de ruido, el temperamento y los cuidados. Elige una especie que encaje con tu espacio y experiencia.
          </p>
        </div>
        <div class="filters-panel__card">
          <h3 class="faq-question">Â¿Los loros son ruidosos?</h3>
          <p class="faq-answer">
            Depende de la especie. Las aves pequeÃ±as suelen ser mÃ¡s silenciosas, mientras que los guacamayos y las cacatÃºas suelen ser ruidosos.
          </p>
        </div>
        <div class="filters-panel__card">
          <h3 class="faq-question">Â¿QuÃ© comen los loros?</h3>
          <p class="faq-answer">
            La mayorÃ­a prospera con pellets, verduras frescas, fruta y pocas semillas. Cada perfil incluye recomendaciones de dieta.
          </p>
        </div>
        <div class="filters-panel__card">
          <h3 class="faq-question">Â¿CuÃ¡nto vive un loro?</h3>
          <p class="faq-answer">
            La esperanza de vida depende de la especie. Muchos loros viven de 15 a mÃ¡s de 60 aÃ±os con buenos cuidados.
          </p>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>
